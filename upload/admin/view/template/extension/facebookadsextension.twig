<!-- Copyright 2017-present, Facebook, Inc.  -->
<!-- All rights reserved. -->

<!-- This source code is licensed under the license found in the -->
<!-- LICENSE file in the root directory of this source tree. -->

<!-- system auto generated, DO NOT MODIFY. -->

<!-- system auto generated dia.js, DO NOT MODIFY -->
<script src='view/javascript/facebook/dia_2_1_13.js' type='text/javascript'></script>
<!-- system auto generated dia.js, DO NOT MODIFY -->
<link href="view/stylesheet/facebook/dia.css" type="text/css" rel="stylesheet" />
<script>
  (function () {
    var fb_url = 'www.facebook.com';
    var debug_url = '{{ debug_url }}';
    if (debug_url) {
      fb_url = debug_url;
    }

    window.facebookAdsToolboxConfig = {
      hasGzipSupport: '{{ has_gzip_support }}',
      enabledPlugins: ['MESSENGER_CHAT'],
      popupOrigin: 'https://' + fb_url,
      feedWasDisabled: 'true',
      platform: 'OpenCart',
      pixel: {
        pixelId: '{{ facebook_pixel_id }}',
        advanced_matching_supported: true
      },
      diaSettingId: '{{ facebook_dia_setting_id }}',
      store: {
        baseUrl: window.location.protocol + '//' + window.location.host,
        baseCurrency: '{{ base_currency }}',
        canSetupShop: true,
        timezoneId: '{{ time_zone_id }}',
        storeName: '{{ store_name }}',
        version: '{{ opencart_version }}',
        php_version: '{{ php_version }}',
        plugin_version: '{{ plugin_version }}'
      },
      feed: {
        totalVisibleProducts: {{ total_visible_products }}
      },
      feedPrepared: {
        feedUrl: '',
        feedPingUrl: '',
        samples: {{ sample_feed }}
      },
      debug_url: debug_url,
      token_string: '{{ token_string }}',
    };

    window.initial_product_sync = {{ initial_product_sync }};
  })();
</script>

{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
{% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
{% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    <div class="alert alert-danger" id="divErrorText">
    </div>
    {% if plugin_upgrade_message %}
      <div class="alert alert-info"><i class="fa fa-exclamation-circle"></i>
        {{ plugin_upgrade_message }}
        <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
{% endif %}
    {% if download_log_file_error_warning %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ download_log_file_error_warning }}
        <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
{% endif %}
    {% if plugin_code_injection_error_messages %}
      <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ plugin_code_injection_error_messages }}
        <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
{% endif %}
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="facebook-header">
          <table><tbody>
            <tr><td><i class="logo"></i></td>
            <td><span class="title">{{ heading_title }}</span></td></tr>
          </tbody></table>
        </div>
        <div class="dia-flow-container">
          <div class="version">
            Plugin Version: {{ plugin_version }}
          </div>        
          <h1>{{ sub_heading_title }}</h1>
          <h2>{{ body_text }}</h2>
          <h2 id="h2DiaSettingId">
          </h2>
          <div>
            <button
              type="button"
              class="blue"
              onClick="_facebookAdsExtension.dia.launchDiaWizard()"
              id="btnLaunchDiaWizard">
            </button>
          </div>
          <div id="divProductSyncStatus" class="product-sync-status">
            <div class="product-sync-status">
              <img
                src="view/image/facebook/loadingicon.gif"
                width="20"
                height="20"/>
            </div>
            <div
              id="divProductSyncStatusText"
              class="product-sync-status-dotted-underline">
            </div>
            <div class="product-sync-status-tooltiptext">
              {{ product_sync_tooltip_text }}
            </div>
          </div>
          <div>
            <button
              type="button"
              class="blue"
              onClick="_facebookAdsExtension.dia.resyncAllProducts(
                '{{ resync_confirm_text }}')"
              id="btnResyncProducts">
              {{ resync_text }}
            </button>
          </div>

          <div class="download">
            <a class="download" href="{{ download_log_link }}">
              {{ download_log_file_text }}
            </a>
          </div>
        </div>
      </div>

      <div class="panel-body" id="divSettings">
        <div class="container-fluid">
          <div class="pull-right">
            <button title="Save" class="btn btn-primary" id="buttonSave"><i class="fa fa-save"></i></button>
          </div>
        </div>
        <div class="container-fluid">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title"><i class="fa fa-list"></i> {{ sub_heading_settings }}</h3>
            </div>
            <div class="panel-body">
              <form class="form-horizontal">
                <div class="form-group">
                  <label class="col-sm-2 control-label">{{ enable_cookie_bar_text }}</label>
                  <div class="checkbox">
                    <input
                      type="checkbox"
                      id="checkboxEnableCookieBar"
                      class="form-control"
                      {{ checked_enable_cookie_bar }} >
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-2 control-label">{{ enable_special_price_text }}</label>
                  <div class="checkbox">
                    <input
                      type="checkbox"
                      id="checkboxEnableSpecialPrice"
                      class="form-control"
                      {{ checked_enable_special_price }} >
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<script type="text/javascript">
  $(function () {
    $("#buttonSave").on('click', function() {
      settingsKeyValueData = {
        '{{ enable_cookie_bar_key }}': $("#checkboxEnableCookieBar").prop('checked'),
        '{{ enable_special_price_key }}': $("#checkboxEnableSpecialPrice").prop('checked')
      };
      _facebookAdsExtension.dia.updateSettings(
        settingsKeyValueData,
        function() {
          alert("{{ alert_settings_saved }}");
        }
      );
    });

    _facebookAdsExtension.dia.refreshUIForDiaSettings();
  });
</script>
{{ footer }}
